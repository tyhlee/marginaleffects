<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal Effects, Marginal Means, Predictions, and Contrasts • marginaleffects</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Marginal Effects, Marginal Means, Predictions, and Contrasts">
<meta property="og:description" content="Compute, summarize, and plot marginal effects, adjusted predictions, contrasts, and marginal means for a wide variety of models.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">marginaleffects</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/mfx.html">Marginal effects</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html">Adjusted predictions</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html">Contrasts</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html">Marginal means</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="the-marginaleffects-package-for-r-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#the-marginaleffects-package-for-r-" class="anchor"></a>The <code>marginaleffects</code> package for <code>R</code> <img src="https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png" align="right" alt="" height="150">
</h1></div>
<!-- badges: start -->

<div id="what" class="section level2">
<h2 class="hasAnchor">
<a href="#what" class="anchor"></a>What?</h2>
<p>The <code>marginaleffects</code> package allows <code>R</code> users to compute and plot four principal quantities of interest for a <em>wide</em> variety of models:</p>
<ul>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/mfx.html"><em>Marginal Effect</em> (Vignette)</a>
<ul>
<li>A partial derivative (slope) of the regression equation with respect to a regressor of interest.</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html"><em>Adjusted Prediction</em> (Vignette)</a>
<ul>
<li>The outcome predicted by a model for some combination of the regressors’ values, such as their means or factor levels (a.k.a. “reference grid”).</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html"><em>Contrast</em> (Vignette)</a>
<ul>
<li>The difference between two adjusted predictions, calculated for meaningfully different regressor values (e.g., College graduates vs. Others).</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html"><em>Marginal Mean</em> (Vignette)</a>
<ul>
<li>Adjusted predictions of a model, averaged across a “reference grid” of categorical predictors.</li>
</ul>
</li>
</ul>
</div>
<div id="why" class="section level2">
<h2 class="hasAnchor">
<a href="#why" class="anchor"></a>Why?</h2>
<p>To calculate marginal effects we need to take derivatives of the regression equation. This can be challenging to do manually, especially when our models are non-linear, or when regressors are transformed or interacted. Computing the variance of a marginal effect is even more difficult.</p>
<p>The <code>marginaleffects</code> package hopes to do most of this hard work for you.</p>
<p>Many <code>R</code> packages advertise their ability to compute “marginal effects.” However, most of them do <em>not</em> actually compute marginal effects <em>as defined above</em>. Instead, they compute “adjusted predictions” for different regressor values, or differences in adjusted predictions (i.e., “contrasts”). The rare packages that actually compute marginal effects are typically limited in the model types they support, and in the range of transformations they allow (interactions, polynomials, etc.).</p>
<p>The main packages in the <code>R</code> ecosystem to compute marginal effects are the trailblazing and powerful <a href="https://cran.r-project.org/package=margins"><code>margins</code> by Thomas J. Leeper</a>, and <a href="https://cran.r-project.org/package=emmeans"><code>emmeans</code> by Russell V. Lenth and contributors.</a> The <code>marginaleffects</code> package is essentially a clone of <code>margins</code>, with some additional features from <code>emmeans</code>.</p>
<p>So why did I write a clone?</p>
<ul>
<li>
<em>Powerful:</em> Marginal effects and contrasts can be computed for about 40 different kinds of models. Adjusted predictions and marginal means can be computed for about 100 model types.</li>
<li>
<em>Extensible:</em> Adding support for new models is very easy, often requiring less than 10 lines of new code. Please submit <a href="https://github.com/vincentarelbundock/marginaleffects/issues">feature requests on Github.</a>
</li>
<li>
<em>Fast:</em> <a href="https://vincentarelbundock.github.io/marginaleffects/articles/benchmark.html">In one benchmark,</a> computing unit-level standard errors is over 400x faster with <code>marginaleffects</code> (minutes vs. milliseconds).</li>
<li>
<em>Efficient:</em> Smaller memory footprint (1.8GB vs 52MB in the same example).</li>
<li>
<em>Valid:</em> When possible, numerical results are checked against alternative software like <code>Stata</code>, or other <code>R</code> packages.</li>
<li>
<em>Beautiful:</em> <code>ggplot2</code> support for plotting (conditional) marginal effects and adjusted predictions.</li>
<li>
<em>Tidy:</em> The results produced by <code>marginaleffects</code> follow “tidy” principles. They are easy to program with and feed to <a href="https://vincentarelbundock.github.io/marginaleffects/">other packages like <code>modelsummary</code>.</a>
</li>
<li>
<em>Simple:</em> All functions share a simple, unified, and well-documented interface.</li>
<li>
<em>Thin:</em> The package requires few dependencies.</li>
<li>
<em>Safe:</em> User input is checked extensively before computation. When needed, functions fail gracefully with informative error messages.</li>
<li><em>Active development</em></li>
</ul>
<p>Downsides of <code>marginaleffects</code> include:</p>
<ul>
<li>Functions to estimate contrasts and marginal means are considerably less flexible than <code>emmeans</code>.</li>
<li>Simulation-based inference is not supported.</li>
<li>Newer package with a smaller (read: nonexistent) user base.</li>
</ul>
</div>
<div id="how" class="section level2">
<h2 class="hasAnchor">
<a href="#how" class="anchor"></a>How?</h2>
<p>By using <a href="https://cran.r-project.org/package=numDeriv">the <code>numDeriv</code> package</a> to compute gradients and jacobians, and <a href="https://easystats.github.io/insight/">the <code>insight</code> package</a> to extract information from model objects. That’s it. That’s the secret sauce.</p>
</div>
<div id="supported-models" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-models" class="anchor"></a>Supported models</h2>
<div id="adjusted-predictions-and-marginal-means" class="section level4">
<h4 class="hasAnchor">
<a href="#adjusted-predictions-and-marginal-means" class="anchor"></a>Adjusted predictions and marginal means</h4>
<p>Under the hood, <code>marginaleffects</code>’s <code>predictions</code> function uses the <code>insight</code> package to retrieve adjusted predictions from a wide variety of models. Currently, <code>insight</code> <a href="https://easystats.github.io/insight/">supports over 200 types of model objects</a>, and most of those should work out-of-the-box with the <code>predictions</code> function. If you run into problems, do not hesitate to report them on Github or via email.</p>
</div>
<div id="marginal-effects-and-contrasts" class="section level4">
<h4 class="hasAnchor">
<a href="#marginal-effects-and-contrasts" class="anchor"></a>Marginal effects and contrasts</h4>
<p>This table shows the list of models supported by the <code>marginaleffects</code> function, and shows which numerical results – marginal effects (dY/dX) or standard errors (Std. Error) – have been checked against alternative software packages: Stata’s <code>margins</code> command and R’s <code>margins</code> package. Empty cells mean that the results of a model have not yet been validated against external software. Green cells indicate that the results of <a href="https://github.com/vincentarelbundock/marginaleffects/tree/main/tests/testthat">at least one model from the test suite</a> match to a reasonable tolerance. Red cells mean that <code>marginaleffects</code> results do <em>not</em> match those produced by alternative software packages. Obviously, caution is especially warranted when working with estimates from red cells.</p>
<p>I am <em>very</em> eager to add support for new models. Feel free to file a request on Github or – even better – submit some code.</p>
<p>Warning: When using <code>marginaleffects</code> with different models, you will probably have to adjust the <code>type</code> argument. Refer to the documentation of your modeling package to see what <code>type</code> argument is allowed in the <code>predict</code> function.</p>
<p><img src="reference/figures/README-supported_models.png" width="60%"></p>
</div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of <code>marginaleffects</code> from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"marginaleffects"</span><span class="op">)</span></code></pre></div>
<p>You can install the development version of <code>marginaleffects</code> from Github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"vincentarelbundock/marginaleffects"</span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>First, we estimate a linear regression model with multiplicative interactions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span> <span class="op">*</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<div id="marginal-effects" class="section level4">
<h4 class="hasAnchor">
<a href="#marginal-effects" class="anchor"></a>Marginal effects</h4>
<p>A “marginal effect” is a unit-specific measure of association between a change in a regressor and a change in the regressand. The <code>marginaleffects</code> function thus computes a distinct estimate of the marginal effect and of the standard error for each regressor (“term”), for each unit of observation (“rowid”). You can view and manipulate the full results with functions like <code>head</code>, as you would with any other <code>data.frame</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/marginaleffects.html">marginaleffects</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt;   rowid     type term       dydx std.error  mpg  hp    wt am predicted</span>
<span class="co">#&gt; 1     1 response   am  0.3251736  1.682202 21.0 110 2.620  1  22.48857</span>
<span class="co">#&gt; 2     2 response   am -0.5438639  1.568211 21.0 110 2.875  1  20.80186</span>
<span class="co">#&gt; 3     3 response   am  1.2007132  2.347558 22.8  93 2.320  1  25.26465</span>
<span class="co">#&gt; 4     4 response   am -1.7025805  1.867130 21.4 110 3.215  0  20.25549</span></code></pre></div>
<p>The function <code>summary</code> calculates the “Average Marginal Effect,” that is, the average of all unit-specific marginal effects:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span>
<span class="co">#&gt; Average marginal effects </span>
<span class="co">#&gt;       type Term   Effect Std. Error  z value   Pr(&gt;|z|)    2.5 %   97.5 %</span>
<span class="co">#&gt; 1 response   am -0.04811    1.85260 -0.02597 0.97928233 -3.67913  3.58291</span>
<span class="co">#&gt; 2 response   hp -0.03807    0.01279 -2.97717 0.00290923 -0.06314 -0.01301</span>
<span class="co">#&gt; 3 response   wt -3.93909    1.08596 -3.62728 0.00028642 -6.06754 -1.81065</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  lm </span>
<span class="co">#&gt; Prediction type:  response</span></code></pre></div>
<p>The <code>plot_cme</code> plots “Conditional Marginal Effects,” that is, the marginal effects estimated at different values of a regressor (often an interaction):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot_cme.html">plot_cme</a></span><span class="op">(</span><span class="va">mod</span>, effect <span class="op">=</span> <span class="st">"hp"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"am"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div id="adjusted-predictions" class="section level4">
<h4 class="hasAnchor">
<a href="#adjusted-predictions" class="anchor"></a>Adjusted predictions</h4>
<p>Beyond marginal effects, we can also use the <code>predictions</code> function to estimate – you guessed it – adjusted predicted values. We use the <code>variables</code> argument to select the categorical variables that will form a “grid” of predictor values over which to compute means/predictions:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"am"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;           type predicted std.error  conf.low conf.high       hp am     wt</span>
<span class="co">#&gt; 1  expectation 23.259500 2.7059342 17.674726  28.84427 146.6875  0 1.5130</span>
<span class="co">#&gt; 2  expectation 27.148334 2.8518051 21.262498  33.03417 146.6875  1 1.5130</span>
<span class="co">#&gt; 3  expectation 20.504387 1.3244556 17.770845  23.23793 146.6875  0 2.5425</span>
<span class="co">#&gt; 4  expectation 21.555612 1.0723852 19.342318  23.76891 146.6875  1 2.5425</span>
<span class="co">#&gt; 5  expectation 18.410286 0.6151016 17.140779  19.67979 146.6875  0 3.3250</span>
<span class="co">#&gt; 6  expectation 17.304709 1.5528055 14.099876  20.50954 146.6875  1 3.3250</span>
<span class="co">#&gt; 7  expectation 17.540532 0.7293676 16.035192  19.04587 146.6875  0 3.6500</span>
<span class="co">#&gt; 8  expectation 15.539158 2.1453449 11.111383  19.96693 146.6875  1 3.6500</span>
<span class="co">#&gt; 9  expectation 12.793013 2.9784942  6.645703  18.94032 146.6875  0 5.4240</span>
<span class="co">#&gt; 10 expectation  5.901966 5.8149853 -6.099574  17.90351 146.6875  1 5.4240</span></code></pre></div>
<p>The <a href="https://vincentarelbundock.github.io/marginaleffects/reference/typical.html"><code>typical</code> function gives us an even more powerful way</a> to customize the grid:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="reference/typical.html">typical</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;          type predicted std.error conf.low conf.high       hp am wt</span>
<span class="co">#&gt; 1 expectation  21.95621  2.038630 17.74868  26.16373 146.6875  0  2</span>
<span class="co">#&gt; 2 expectation  16.60387  1.083201 14.36826  18.83949 146.6875  0  4</span></code></pre></div>
<p>We can plot the adjusted predictions with the <code>plot_cap</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
<p>Or you can work with the output of the <code>predictions</code> or <code>marginaleffects</code> directly to create your own plots. For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="fu"><a href="reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, 
              newdata <span class="op">=</span> <span class="fu"><a href="reference/typical.html">typical</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, 
                                wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fivenum.html">fivenum</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">wt</span><span class="op">)</span>, 
                                hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">predicted</span>, ymin <span class="op">=</span> <span class="va">conf.low</span>, ymax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">am</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"></p>
<p>And of course, categorical variables work too:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>
<span class="fu"><a href="reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"cyl"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
</div>
<div id="marginal-means" class="section level4">
<h4 class="hasAnchor">
<a href="#marginal-means" class="anchor"></a>Marginal means</h4>
<p>To compute marginal means, we first need to make sure that the categorical variables of our model are coded as such in the dataset:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mtcars</span>
<span class="va">dat</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html">as.logical</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">am</span><span class="op">)</span>
<span class="va">dat</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></code></pre></div>
<p>Then, we estimate the model and call the <code>marginalmeans</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/marginalmeans.html">marginalmeans</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>
<span class="co">#&gt; Estimated marginal means </span>
<span class="co">#&gt;   Term Group  Mean Std. Error z value   Pr(&gt;|z|) 2.5 % 97.5 %</span>
<span class="co">#&gt; 1   am FALSE 18.32     0.7854   23.33 &lt; 2.22e-16 16.78  19.86</span>
<span class="co">#&gt; 2   am  TRUE 22.48     0.8343   26.94 &lt; 2.22e-16 20.84  24.11</span>
<span class="co">#&gt; 3  cyl     4 22.88     1.3566   16.87 &lt; 2.22e-16 20.23  25.54</span>
<span class="co">#&gt; 4  cyl     6 18.96     1.0729   17.67 &lt; 2.22e-16 16.86  21.06</span>
<span class="co">#&gt; 5  cyl     8 19.35     1.3771   14.05 &lt; 2.22e-16 16.65  22.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  lm </span>
<span class="co">#&gt; Prediction type:  expectation</span></code></pre></div>
</div>
<div id="more" class="section level4">
<h4 class="hasAnchor">
<a href="#more" class="anchor"></a>More</h4>
<p>There is <em>much</em> more you can do with <code>marginaleffects</code>. Please read the other articles on this website to learn how to report marginal effects and means in <a href="https://vincentarelbundock.github.io/modelsummary/">nice tables with the <code>modelsummary</code> package</a>, how to define your own prediction “grid”, and more:</p>
<ul>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/mfx.html"><em>Marginal Effect</em> (Vignette)</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html"><em>Adjusted Prediction</em> (Vignette)</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html"><em>Contrast</em> (Vignette)</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html"><em>Marginal Mean</em> (Vignette)</a></li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/vincentarelbundock/marginaleffects/">https://​github.com/​vincentarelbundock/​marginaleffects/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/vincentarelbundock/marginaleffects/issues">https://​github.com/​vincentarelbundock/​marginaleffects/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Vincent Arel-Bundock <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2042-7063" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://codecov.io/gh/vincentarelbundock/marginaleffects?branch=main"><img src="https://codecov.io/gh/vincentarelbundock/marginaleffects/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/vincentarelbundock/marginaleffects/actions"><img src="https://github.com/vincentarelbundock/marginaleffects/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
