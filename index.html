<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal Effects, Marginal Means, Predictions, and Contrasts • marginaleffects</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Marginal Effects, Marginal Means, Predictions, and Contrasts">
<meta property="og:description" content="Compute, summarize, and plot marginal effects, adjusted predictions, contrasts, and marginal means for a wide variety of models.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">marginaleffects</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html" class="external-link">Adjusted predictions</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginaleffects.html" class="external-link">Marginal effects</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html" class="external-link">Contrasts</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html" class="external-link">Marginal means</a>
</li>
<li>
  <a href="https://vincentarelbundock.github.io/marginaleffects/articles/hypothesis.html" class="external-link">Hypothesis Tests</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="the-marginaleffects-package-for-r-">The <code>marginaleffects</code> package for <code>R</code> <img src="https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png" align="right" alt="" width="120"><a class="anchor" aria-label="anchor" href="#the-marginaleffects-package-for-r-"></a>
</h1></div>
<!-- badges: start -->
<p><code>marginaleffects</code> is an R package to compute and plot adjusted predictions, marginal effects, contrasts, and marginal means for a <em>wide</em> variety of models.</p>
<div class="section level2">
<h2 id="table-of-contents">Table of contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h2>
<p>Introduction:</p>
<ul>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/#definitions" class="external-link">Definitions</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/#motivation" class="external-link">Motivation</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/#getting-started" class="external-link">Getting started</a></li>
</ul>
<p>Vignettes:</p>
<ul>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html" class="external-link">Adjusted Predictions</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html" class="external-link">Contrasts</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginaleffects.html" class="external-link">Marginal Effects</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html" class="external-link">Marginal Means</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/hypothesis.html" class="external-link">Hypothesis Tests, Delta Method, and Custom Contrasts</a></li>
</ul>
<p>Case studies:</p>
<ul>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/brms.html" class="external-link">Bayesian Analyses with <code>brms</code></a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/gformula.html" class="external-link">Causal Inference with the g-Formula</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/gam.html" class="external-link">Generalized Additive Models</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/lme4.html" class="external-link">Mixed effects models</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/mlogit.html" class="external-link">Multinomial Logit and Discrete Choice Models</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/multiple_imputation.html" class="external-link">Multiple Imputation</a></li>
</ul>
<p>Tips and technical notes:</p>
<ul>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/supported_models.html" class="external-link">64 Supported Classes of Models</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/reference/index.html" class="external-link">Index of Functions and Documentation</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/sandwich.html" class="external-link">Standard Errors</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/modelsummary.html" class="external-link">Tables and Plots</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/performance.html" class="external-link">Performance</a></li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/articles/alternative_software.html" class="external-link">Alternative Software</a></li>
</ul>
<p>External links:</p>
<ul>
<li>
<a href="https://www.ajordannafa.com/blog/2022/05/24/bma-ames/" class="external-link">Bayesian Model Averaged Marginal Effects</a> by A. Jordan Nafa</li>
<li>
<a href="https://www.andrewheiss.com/blog/2022/05/20/marginalia/" class="external-link">Marginalia: A guide to figuring out what the heck marginal effects, marginal slopes, average marginal effects, marginal effects at the mean, and all these other marginal things are</a> by Andrew Heiss</li>
</ul>
</div>
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<p>The <code>marginaleffects</code> package allows <code>R</code> users to compute and plot four principal quantities of interest for <a href="https://vincentarelbundock.github.io/marginaleffects/articles/supported_models.html" class="external-link">64 different classes of models:</a></p>
<ul>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html" class="external-link"><em>Adjusted Prediction</em></a><ul>
<li>The outcome predicted by a fitted model on a specified scale for a given combination of values of the predictor variables, such as their observed values, their means, or factor levels (a.k.a. “reference grid”).</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/reference/predictions.html" class="external-link"><code>predictions(),</code></a> <a href="https://vincentarelbundock.github.io/marginaleffects/reference/predictions.html" class="external-link"><code>plot_cap()</code></a>
</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginaleffects.html" class="external-link"><em>Marginal Effect</em></a><ul>
<li>A partial derivative (slope) of the regression equation with respect to a regressor of interest.</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/reference/marginaleffects.html" class="external-link"><code>marginaleffects(),</code></a> <a href="https://vincentarelbundock.github.io/marginaleffects/reference/plot.marginaleffects.html" class="external-link"><code>plot(),</code></a> <a href="https://vincentarelbundock.github.io/marginaleffects/reference/plot_cme.html" class="external-link"><code>plot_cme()</code></a>
</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html" class="external-link"><em>Contrast</em></a><ul>
<li>A difference, ratio, or function of adjusted predictions, calculated for meaningfully different predictor values (e.g., College graduates vs. Others).</li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/reference/comparisons.html" class="external-link"><code>comparisons()</code></a></li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html" class="external-link"><em>Marginal Mean</em></a><ul>
<li>Adjusted predictions of a model, averaged across a “reference grid” of categorical predictors.</li>
<li><a href="https://vincentarelbundock.github.io/marginaleffects/reference/marginalmeans.html" class="external-link"><code>marginalmeans()</code></a></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>To calculate marginal effects we need to take derivatives of the regression equation. This can be challenging to do manually, especially when our models are non-linear, or when regressors are transformed or interacted. Computing the variance of a marginal effect is even more difficult.</p>
<p>The <code>marginaleffects</code> package hopes to do most of this hard work for you.</p>
<p>Many <code>R</code> packages advertise their ability to compute “marginal effects.” However, most of them do <em>not</em> actually compute marginal effects <em>as defined above</em>. Instead, they compute “adjusted predictions” for different regressor values, or differences in adjusted predictions (i.e., “contrasts”). The rare packages that actually compute marginal effects are typically limited in the model types they support, and in the range of transformations they allow (interactions, polynomials, etc.).</p>
<p>The main packages in the <code>R</code> ecosystem to compute marginal effects are the trailblazing and powerful <a href="https://cran.r-project.org/package=margins" class="external-link"><code>margins</code> by Thomas J. Leeper</a>, and <a href="https://cran.r-project.org/package=emmeans" class="external-link"><code>emmeans</code> by Russell V. Lenth and contributors.</a> The <code>marginaleffects</code> package is essentially a clone of <code>margins</code>, with some additional features from <code>emmeans</code>.</p>
<p>So why did I write a clone?</p>
<ul>
<li>
<em>Powerful:</em> Marginal effects and contrasts can be computed for 64 different classes of models. Adjusted predictions and marginal means can be computed for about 100 model types.</li>
<li>
<em>Extensible:</em> Adding support for new models is very easy, often requiring less than 10 lines of new code. Please submit <a href="https://github.com/vincentarelbundock/marginaleffects/issues" class="external-link">feature requests on Github.</a>
</li>
<li>
<em>Fast:</em> <a href="https://vincentarelbundock.github.io/marginaleffects/articles/performance.html" class="external-link">Computing unit-level standard errors</a> can be orders of magnitude faster in large datasets.</li>
<li>
<em>Efficient:</em> Much smaller memory footprint.</li>
<li>
<em>Valid:</em> When possible, numerical results are checked against alternative software like <code>Stata</code>, or other <code>R</code> packages.</li>
<li>
<em>Beautiful:</em> <code>ggplot2</code> support for plotting (conditional) marginal effects and adjusted predictions.</li>
<li>
<em>Tidy:</em> The results produced by <code>marginaleffects</code> follow “tidy” principles. They are easy to program with and feed to <a href="https://vincentarelbundock.github.io/marginaleffects/" class="external-link">other packages like <code>modelsummary</code>.</a>
</li>
<li>
<em>Simple:</em> All functions share a simple, unified, and well-documented interface.</li>
<li>
<em>Thin:</em> The package requires relatively few dependencies.</li>
<li>
<em>Safe:</em> User input is checked extensively before computation. When needed, functions fail gracefully with informative error messages.</li>
<li><em>Active development</em></li>
</ul>
<p>Downsides of <code>marginaleffects</code> include:</p>
<ul>
<li>No simulation-based inference.</li>
<li>No multiplicity adjustments.</li>
<li>No equivalence tests.</li>
<li>Newer package with a smaller user base.</li>
</ul>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level4">
<h4 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h4>
<p>You can install the released version of <code>marginaleffects</code> from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"marginaleffects"</span><span class="op">)</span></code></pre></div>
<p>You can install the development version of <code>marginaleffects</code> from Github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"vincentarelbundock/marginaleffects"</span><span class="op">)</span></code></pre></div>
<p>First, we estimate a linear regression model with multiplicative interactions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/" class="external-link">marginaleffects</a></span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span> <span class="op">*</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adjusted-predictions">Adjusted predictions<a class="anchor" aria-label="anchor" href="#adjusted-predictions"></a>
</h4>
<p>An “adjusted prediction” is the outcome predicted by a model for some combination of the regressors’ values, such as their observed values, their means, or factor levels (a.k.a. “reference grid”).</p>
<p>By default, the <code><a href="reference/predictions.html">predictions()</a></code> function returns adjusted predictions for every value in original dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;   rowid     type predicted std.error statistic       p.value conf.low</span>
<span class="co">#&gt; 1     1 response  22.48857 0.8841487  25.43528 1.027254e-142 20.75567</span>
<span class="co">#&gt; 2     2 response  20.80186 1.1942050  17.41900  5.920119e-68 18.46126</span>
<span class="co">#&gt; 3     3 response  25.26465 0.7085307  35.65781 1.783452e-278 23.87596</span>
<span class="co">#&gt; 4     4 response  20.25549 0.7044641  28.75305 8.296026e-182 18.87477</span>
<span class="co">#&gt; 5     5 response  16.99782 0.7118658  23.87784 5.205109e-126 15.60259</span>
<span class="co">#&gt; 6     6 response  19.66353 0.8753226  22.46433 9.270636e-112 17.94793</span>
<span class="co">#&gt;   conf.high  mpg  hp    wt am</span>
<span class="co">#&gt; 1  24.22147 21.0 110 2.620  1</span>
<span class="co">#&gt; 2  23.14246 21.0 110 2.875  1</span>
<span class="co">#&gt; 3  26.65335 22.8  93 2.320  1</span>
<span class="co">#&gt; 4  21.63622 21.4 110 3.215  0</span>
<span class="co">#&gt; 5  18.39305 18.7 175 3.440  0</span>
<span class="co">#&gt; 6  21.37913 18.1 105 3.460  0</span></code></pre></div>
<p>The <a href="https://vincentarelbundock.github.io/marginaleffects/reference/datagrid.html" class="external-link"><code>datagrid</code> function gives us a powerful way to define a grid of predictors.</a> All the variables not mentioned explicitly in <code><a href="reference/datagrid.html">datagrid()</a></code> are fixed to their mean or mode:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="reference/datagrid.html">datagrid</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   rowid     type predicted std.error statistic       p.value conf.low</span>
<span class="co">#&gt; 1     1 response  21.95621 2.0386301  10.77008  4.765935e-27 17.96057</span>
<span class="co">#&gt; 2     2 response  21.42097 1.7699036  12.10290  1.019401e-33 17.95203</span>
<span class="co">#&gt; 3     3 response  20.88574 1.5067373  13.86157  1.082834e-43 17.93259</span>
<span class="co">#&gt; 4     4 response  20.35051 1.2526403  16.24609  2.380723e-59 17.89538</span>
<span class="co">#&gt; 5     5 response  19.81527 1.0144509  19.53301  5.755097e-85 17.82699</span>
<span class="co">#&gt; 6     6 response  19.28004 0.8063905  23.90906 2.465206e-126 17.69954</span>
<span class="co">#&gt;   conf.high       hp am  wt mpg</span>
<span class="co">#&gt; 1  25.95185 146.6875  0 2.0   0</span>
<span class="co">#&gt; 2  24.88992 146.6875  0 2.2   0</span>
<span class="co">#&gt; 3  23.83889 146.6875  0 2.4   0</span>
<span class="co">#&gt; 4  22.80564 146.6875  0 2.6   0</span>
<span class="co">#&gt; 5  21.80356 146.6875  0 2.8   0</span>
<span class="co">#&gt; 6  20.86054 146.6875  0 3.0   0</span></code></pre></div>
<p>We can plot how predictions change for different values of one or more variables – Conditional Adjusted Predictions – using the <code>plot_cap</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>
<span class="fu"><a href="reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod2</span>, condition <span class="op">=</span> <span class="st">"cyl"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<p><a href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html" class="external-link">The Adjusted Predictions vignette</a> shows how to use the <code><a href="reference/predictions.html">predictions()</a></code> and <code><a href="reference/plot_cap.html">plot_cap()</a></code> functions to compute a wide variety of quantities of interest:</p>
<ul>
<li>Adjusted Predictions at User-Specified Values (aka Predictions at Representative Values)</li>
<li>Adjusted Predictions at the Mean</li>
<li>Average Predictions at the Mean</li>
<li>Conditional Predictions</li>
<li>Adjusted Predictions on different scales (e.g., link or response)</li>
</ul>
</div>
<div class="section level4">
<h4 id="contrasts">Contrasts<a class="anchor" aria-label="anchor" href="#contrasts"></a>
</h4>
<p>A contrast is the difference between two adjusted predictions, calculated for meaningfully different predictor values (e.g., College graduates vs. Others).</p>
<p>What happens to the predicted outcome when a numeric predictor increases by one unit, and logical variable flips from FALSE to TRUE, and a factor variable shifts from baseline?</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">titanic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/Stat2Data/Titanic.csv"</span><span class="op">)</span>
<span class="va">titanic</span><span class="op">$</span><span class="va">Woman</span> <span class="op">&lt;-</span> <span class="va">titanic</span><span class="op">$</span><span class="va">Sex</span> <span class="op">==</span> <span class="st">"female"</span>
<span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">Woman</span> <span class="op">+</span> <span class="va">Age</span> <span class="op">*</span> <span class="va">PClass</span>, data <span class="op">=</span> <span class="va">titanic</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span>

<span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cmp</span><span class="op">)</span>
<span class="co">#&gt; Average contrasts </span>
<span class="co">#&gt;     Term     Contrast   Effect Std. Error z value   Pr(&gt;|z|)     2.5 %</span>
<span class="co">#&gt; 1  Woman TRUE - FALSE  0.50329   0.031654  15.899 &lt; 2.22e-16  0.441244</span>
<span class="co">#&gt; 2    Age  (x + 1) - x -0.00558   0.001084  -5.147 2.6471e-07 -0.007705</span>
<span class="co">#&gt; 3 PClass    2nd - 1st -0.22603   0.043546  -5.191 2.0950e-07 -0.311383</span>
<span class="co">#&gt; 4 PClass    3rd - 1st -0.38397   0.041845  -9.176 &lt; 2.22e-16 -0.465985</span>
<span class="co">#&gt;      97.5 %</span>
<span class="co">#&gt; 1  0.565327</span>
<span class="co">#&gt; 2 -0.003455</span>
<span class="co">#&gt; 3 -0.140686</span>
<span class="co">#&gt; 4 -0.301957</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  glm </span>
<span class="co">#&gt; Prediction type:  response</span></code></pre></div>
<p>The contrast above used a simple difference between adjusted predictions. We can also used different functions to combine and contrast predictions in different ways. For instance, researchers often compute Adjusted Risk Ratios, which are ratios of predicted probabilities. We can compute such ratios by applying a transformation using the <code>transform_pre</code> argument. We can also present the results of “interactions” between contrasts. What happens to the ratio of predicted probabilities for survival when <code>PClass</code> changes between each pair of factor levels (“pairwise”) and <code>Age</code> changes by 2 standard deviations simultaneously:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/comparisons.html">comparisons</a></span><span class="op">(</span>
    <span class="va">mod3</span>,
    transform_pre <span class="op">=</span> <span class="st">"ratio"</span>,
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Age <span class="op">=</span> <span class="st">"2sd"</span>, PClass <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cmp</span><span class="op">)</span>
<span class="co">#&gt; Average contrasts </span>
<span class="co">#&gt;                   Age    PClass Effect Std. Error z value   Pr(&gt;|z|)</span>
<span class="co">#&gt; 1 (x + sd) / (x - sd) 1st / 1st 0.4583    0.05878   7.798 6.3074e-15</span>
<span class="co">#&gt; 2 (x + sd) / (x - sd) 2nd / 1st 0.4525    0.05876   7.700 1.3580e-14</span>
<span class="co">#&gt; 3 (x + sd) / (x - sd) 3rd / 1st 0.4379    0.05875   7.454 9.0386e-14</span>
<span class="co">#&gt; 4 (x + sd) / (x - sd) 2nd / 2nd 0.4554    0.05877   7.749 9.2602e-15</span>
<span class="co">#&gt; 5 (x + sd) / (x - sd) 3rd / 2nd 0.4263    0.05876   7.255 4.0168e-13</span>
<span class="co">#&gt; 6 (x + sd) / (x - sd) 3rd / 3rd 0.4670    0.05880   7.943 1.9803e-15</span>
<span class="co">#&gt;    2.5 % 97.5 %</span>
<span class="co">#&gt; 1 0.3431 0.5735</span>
<span class="co">#&gt; 2 0.3373 0.5677</span>
<span class="co">#&gt; 3 0.3228 0.5531</span>
<span class="co">#&gt; 4 0.3402 0.5706</span>
<span class="co">#&gt; 5 0.3111 0.5415</span>
<span class="co">#&gt; 6 0.3518 0.5823</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  glm </span>
<span class="co">#&gt; Prediction type:  response</span></code></pre></div>
<p>The code above is explained in detail in the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/transformation.html" class="external-link">vignette on Transformations and Custom Contrasts.</a></p>
<p><a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html" class="external-link">The Contrasts vignette</a> shows how to use the <code><a href="reference/comparisons.html">comparisons()</a></code> function to compute a wide variety of quantities of interest:</p>
<ul>
<li>Custom comparisons for:<ul>
<li>Numeric variables (e.g., 1 standard deviation, interquartile range, custom values)</li>
<li>Factor or character</li>
<li>Logical</li>
</ul>
</li>
<li>Contrast interactions</li>
<li>Unit-level Contrasts</li>
<li>Average Contrasts</li>
<li>Group-Average Contrasts</li>
<li>Contrasts at the Mean</li>
<li>Contrasts Between Marginal Means</li>
<li>Adjusted Risk Ratios</li>
</ul>
</div>
<div class="section level4">
<h4 id="marginal-effects">Marginal effects<a class="anchor" aria-label="anchor" href="#marginal-effects"></a>
</h4>
<p>A “marginal effect” is a partial derivative (slope) of the regression equation with respect to a regressor of interest. It is unit-specific measure of association between a change in a regressor and a change in the regressand. The <code><a href="reference/marginaleffects.html">marginaleffects()</a></code> function uses numerical derivatives to estimate the slope of the regression equation with respect to each of the variables in the model (or contrasts for categorical variables).</p>
<p>By default, <code><a href="reference/marginaleffects.html">marginaleffects()</a></code> estimates the slope for each row of the original dataset that was used to fit the model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/marginaleffects.html">marginaleffects</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mfx</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt;   rowid     type term        dydx  std.error statistic     p.value</span>
<span class="co">#&gt; 1     1 response   hp -0.03690556 0.01850172 -1.994710 0.046074551</span>
<span class="co">#&gt; 2     2 response   hp -0.02868936 0.01562861 -1.835695 0.066402771</span>
<span class="co">#&gt; 3     3 response   hp -0.04657166 0.02258715 -2.061866 0.039220507</span>
<span class="co">#&gt; 4     4 response   hp -0.04227128 0.01328278 -3.182412 0.001460541</span>
<span class="co">#&gt;      conf.low     conf.high  mpg  hp    wt am</span>
<span class="co">#&gt; 1 -0.07316825 -0.0006428553 21.0 110 2.620  1</span>
<span class="co">#&gt; 2 -0.05932087  0.0019421508 21.0 110 2.875  1</span>
<span class="co">#&gt; 3 -0.09084166 -0.0023016728 22.8  93 2.320  1</span>
<span class="co">#&gt; 4 -0.06830506 -0.0162375066 21.4 110 3.215  0</span></code></pre></div>
<p>The function <code>summary</code> calculates the “Average Marginal Effect,” that is, the average of all unit-specific marginal effects:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span>
<span class="co">#&gt; Average marginal effects </span>
<span class="co">#&gt;   Term   Effect Std. Error  z value   Pr(&gt;|z|)    2.5 %   97.5 %</span>
<span class="co">#&gt; 1   hp -0.03807    0.01279 -2.97725 0.00290848 -0.06314 -0.01301</span>
<span class="co">#&gt; 2   wt -3.93909    1.08596 -3.62728 0.00028642 -6.06754 -1.81065</span>
<span class="co">#&gt; 3   am -0.04811    1.85260 -0.02597 0.97928234 -3.67913  3.58292</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  lm </span>
<span class="co">#&gt; Prediction type:  response</span></code></pre></div>
<p>The <code>plot_cme</code> plots “Conditional Marginal Effects,” that is, the marginal effects estimated at different values of a regressor (often an interaction):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plot_cme.html">plot_cme</a></span><span class="op">(</span><span class="va">mod</span>, effect <span class="op">=</span> <span class="st">"hp"</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wt"</span>, <span class="st">"am"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png" width="100%"></p>
<p><a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginaleffects.html" class="external-link">The Marginal Effects vignette</a> shows how to use the <code><a href="reference/marginaleffects.html">marginaleffects()</a></code> function to compute a wide variety of quantities of interest:</p>
<ul>
<li>Unit-level Marginal Effects</li>
<li>Average Marginal Effects</li>
<li>Group-Average Marginal Effects</li>
<li>Marginal Effects at the Mean</li>
<li>Marginal Effects Between Marginal Means</li>
<li>Conditional Marginal Effects</li>
<li>Tables and Plots</li>
</ul>
</div>
<div class="section level4">
<h4 id="marginal-means">Marginal means<a class="anchor" aria-label="anchor" href="#marginal-means"></a>
</h4>
<p>Marginal Means are the adjusted predictions of a model, averaged across a “reference grid” of categorical predictors. To compute marginal means, we first need to make sure that the categorical variables of our model are coded as such in the dataset:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mtcars</span>
<span class="va">dat</span><span class="op">$</span><span class="va">am</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">am</span><span class="op">)</span>
<span class="va">dat</span><span class="op">$</span><span class="va">cyl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span></code></pre></div>
<p>Then, we estimate the model and call the <code>marginalmeans</code> function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">am</span> <span class="op">+</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/marginalmeans.html">marginalmeans</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span>
<span class="co">#&gt; Estimated marginal means </span>
<span class="co">#&gt;   Term Value  Mean Std. Error z value   Pr(&gt;|z|) 2.5 % 97.5 %</span>
<span class="co">#&gt; 1   am FALSE 18.32     0.7854   23.33 &lt; 2.22e-16 16.78  19.86</span>
<span class="co">#&gt; 2   am  TRUE 22.48     0.8343   26.94 &lt; 2.22e-16 20.84  24.11</span>
<span class="co">#&gt; 3  cyl     4 22.88     1.3566   16.87 &lt; 2.22e-16 20.23  25.54</span>
<span class="co">#&gt; 4  cyl     6 18.96     1.0729   17.67 &lt; 2.22e-16 16.86  21.06</span>
<span class="co">#&gt; 5  cyl     8 19.35     1.3771   14.05 &lt; 2.22e-16 16.65  22.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model type:  lm </span>
<span class="co">#&gt; Prediction type:  response </span>
<span class="co">#&gt; Results averaged over levels of: am, cyl</span></code></pre></div>
<p><a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html" class="external-link">The Marginal Means vignette</a> offers more detail.</p>
</div>
<div class="section level4">
<h4 id="more">More<a class="anchor" aria-label="anchor" href="#more"></a>
</h4>
<p>There is <em>much</em> more you can do with <code>marginaleffects</code>. Return to the <a href="https://vincentarelbundock.github.io/marginaleffects/#getting-started" class="external-link">Table of Contents</a> to read the vignettes, learn how to report marginal effects and means in <a href="https://vincentarelbundock.github.io/modelsummary/" class="external-link">nice tables with the <code>modelsummary</code> package</a>, how to define your own prediction “grid”, and much more.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=marginaleffects" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/vincentarelbundock/marginaleffects/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/vincentarelbundock/marginaleffects/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing marginaleffects</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Vincent Arel-Bundock <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0003-2042-7063" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://app.codecov.io/gh/vincentarelbundock/marginaleffects?branch=main" class="external-link"><img src="https://codecov.io/gh/vincentarelbundock/marginaleffects/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/vincentarelbundock/marginaleffects/actions" class="external-link"><img src="https://github.com/vincentarelbundock/marginaleffects/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=marginaleffects" class="external-link"><img src="https://www.r-pkg.org/badges/version/marginaleffects" alt="CRAN status"></a></li>
<li><a href="https://CRAN.R-project.org/package=marginaleffects" class="external-link"><img src="https://tinyverse.netlify.com/badge/marginaleffects" alt="status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
